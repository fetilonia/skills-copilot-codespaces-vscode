<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>MS-102 Practice (Random 50 + Grading)</title>
	<style>
		body {
			font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
			margin: 24px;
			background: #fafafa;
			color: #222;
		}

		h1 {
			font-size: 22px;
			margin: 0 0 10px;
		}

		.sub {
			color: #666;
			margin: 0 0 16px;
		}

		.toolbar {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			margin: 10px 0 16px;
		}

		input[type="text"] {
			padding: 8px;
			border: 1px solid #e5e7eb;
			border-radius: 8px;
		}

		button {
			background: #111827;
			color: #fff;
			border: 0;
			border-radius: 8px;
			padding: 8px 12px;
			cursor: pointer;
		}

		button.secondary {
			background: #f3f4f6;
			color: #111;
		}

		button.ghost {
			background: transparent;
			color: #111;
			border: 1px solid #e5e7eb;
		}

		.card {
			background: #fff;
			border: 1px solid #e5e5e5;
			border-radius: 10px;
			padding: 16px;
			margin: 12px 0;
			box-shadow: 0 2px 5px rgba(0, 0, 0, .03);
		}

		.qhead {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 8px;
		}

		.qno {
			color: #6b7280;
			font-size: 12px;
		}

		.q {
			font-weight: 600;
			margin: 0 0 10px;
		}

		.choices {
			margin: 10px 0;
		}

		.choice {
			display: block;
			margin: 6px 0;
		}

		.ans {
			display: none;
			margin-top: 10px;
			padding: 10px;
			border-radius: 8px;
			background: #f9fafb;
			border: 1px solid #e5e7eb;
		}

		.correct {
			border-color: #16a34a;
			background: #f0fdf4;
		}

		.incorrect {
			border-color: #dc2626;
			background: #fef2f2;
		}

		.stats {
			margin: 12px 0;
			padding: 12px;
			border: 1px dashed #e5e7eb;
			border-radius: 10px;
			background: #fff;
			display: none;
		}

		.footer {
			color: #888;
			font-size: 12px;
			margin-top: 24px;
		}

		.badge {
			font-size: 12px;
			background: #eef2ff;
			color: #3730a3;
			padding: 2px 8px;
			border-radius: 999px;
			margin-left: 8px;
		}
	</style>
</head>

<body>
	<h1>MS-102 Practice <span class="badge">Random 50 + Grading</span></h1>
	<p class="sub">Seed를 지정하면 항상 같은 50개가 선택됩니다. 예: ?seed=20251102</p>

	<div class="toolbar">
		<input id="filter" type="text" placeholder="Filter keyword...">
		<button class="secondary" onclick="applyFilter()">Filter</button>
		<button class="secondary" onclick="resetFilter()">Reset</button>
		<button class="ghost" onclick="reshuffle()">Reshuffle 50</button>
		<button onclick="grade()">Grade</button>
		<button class="secondary" onclick="clearAll()">Clear all</button>
	</div>

	<div id="stats" class="stats"></div>
	<div id="app"></div>

	<hr>
	<div class="footer">Questions sourced from your MS-102
		database.[^https://www.notion.so/29adbd591ead8060a819d8aadb7ed416]</div>

	<script src="questions.js"></script>
	<script>
		// 시드 가능한 난수와 셔플
		function mulberry32(a) { return function () { let t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }
		function seededShuffle(arr, seed) {
			const rnd = mulberry32(seed);
			const a = arr.slice();
			for (let i = a.length - 1; i > 0; i--) {
				const j = Math.floor(rnd() * (i + 1));
				[a[i], a[j]] = [a[j], a[i]];
			}
			return a;
		}
		function pick50(all, seed) {
			const pool = Array.isArray(all) ? all : [];
			if (pool.length <= 50) return pool.slice();
			const s = Number(seed) || Math.floor(Math.random() * 1e9);
			const shuffled = seededShuffle(pool, s);
			return shuffled.slice(0, 50);
		}
		function escapeHTML(s) { return String(s).replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;'); }

		let master = (typeof data !== 'undefined' && Array.isArray(data)) ? data.slice() : [];
		let current = [];
		const app = document.getElementById('app');
		const stats = document.getElementById('stats');

		function render(list) {
			app.innerHTML = '';
			list.forEach((q, idx) => {
				const card = document.createElement('div');
				card.className = 'card';
				card.dataset.qid = q.id;
				const answerId = 'ans_' + q.id;
				card.innerHTML = `
				<div class="qhead">
					<div class="qno">ID: ${escapeHTML(q.id || String(idx + 1))}</div>
				</div>
				<div class="q">${idx + 1}. ${escapeHTML(q.question || '')}</div>
				<div class="choices">
					${Array.isArray(q.choices) && q.choices.length
						? q.choices.map(opt => `
							<label class="choice">
								<input type="radio" name="q_${q.id}" value="${escapeHTML(opt)}"> ${escapeHTML(opt)}
							</label>`).join('')
						: '<em>No choices provided.</em>'
					}
				</div>
				<div>
					<button class="ghost" onclick="toggleAnswer('${answerId}')">Show Answer</button>
					<button class="secondary" onclick="clearSelect('${q.id}')">Clear</button>
				</div>
				<div id="${answerId}" class="ans">
					<strong>Answer:</strong> ${escapeHTML(q.answer || '')}
					${q.explain ? `<div style="margin-top:6px;"><em>${escapeHTML(q.explain)}</em></div>` : ''}
				</div>
			`;
				app.appendChild(card);
			});
			stats.style.display = 'none';
			stats.innerHTML = '';
		}

		function toggleAnswer(id) {
			const el = document.getElementById(id);
			if (!el) return;
			el.style.display = (el.style.display === 'block') ? 'none' : 'block';
		}
		function clearSelect(id) {
			document.querySelectorAll('input[name="q_' + id + '"]').forEach(el => el.checked = false);
			const card = document.querySelector('.card[data-qid="' + id + '"]');
			if (card) { card.classList.remove('correct', 'incorrect'); }
		}
		function clearAll() {
			current.forEach(q => clearSelect(q.id));
			document.querySelectorAll('.ans').forEach(el => el.style.display = 'none');
			stats.style.display = 'none';
			stats.innerHTML = '';
		}

		function grade() {
			let correct = 0;
			let answered = 0;
			current.forEach(q => {
				const selected = document.querySelector('input[name="q_' + q.id + '"]:checked');
				const card = document.querySelector('.card[data-qid="' + q.id + '"]');
				if (!card) return;
				card.classList.remove('correct', 'incorrect');
				if (selected) {
					answered++;
					const val = selected.value.trim();
					if (q.answer && val === q.answer) {
						correct++;
						card.classList.add('correct');
					} else {
						card.classList.add('incorrect');
					}
				}
			});
			const total = current.length;
			const score = Math.round((correct / total) * 100);
			stats.style.display = 'block';
			stats.innerHTML = `<strong>Result:</strong> ${correct}/${total} correct, Score: ${score}%<br><small>Answered: ${answered}, Skipped: ${total - answered}</small>`;
		}

		function applyFilter() {
			const kw = document.getElementById('filter').value.trim().toLowerCase();
			if (!kw) { render(current); return; }
			const filtered = current.filter(q =>
				(q.question || '').toLowerCase().includes(kw) ||
				(q.answer || '').toLowerCase().includes(kw) ||
				(q.choices || []).some(c => c.toLowerCase().includes(kw))
			);
			render(filtered);
		}
		function resetFilter() {
			document.getElementById('filter').value = '';
			render(current);
		}
		function reshuffle() {
			const url = new URL(location.href);
			const seed = url.searchParams.get('seed');
			current = pick50(master, seed || Math.floor(Math.random() * 1e9));
			render(current);
		}

		// 전역에서 접근 가능하도록 연결
		window.toggleAnswer = toggleAnswer;
		window.clearSelect = clearSelect;
		window.applyFilter = applyFilter;
		window.resetFilter = resetFilter;
		window.reshuffle = reshuffle;
		window.grade = grade;
		window.clearAll = clearAll;

		(function init() {
			const url = new URL(location.href);
			const seed = url.searchParams.get('seed') || undefined;
			current = pick50(master, seed);
			render(current);
		})();
	</script>
</body>

</html>