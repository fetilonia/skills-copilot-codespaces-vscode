<!doctype html>
<html lang="ko">

<head>
	<meta charset="utf-8">
	<title>Practice Exam – MS-102</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		:root {
			--bg: #0b1020;
			--card: #11182a;
			--text: #e6e9f2;
			--muted: #aab2c5;
			--accent: #4f7cff;
			--ok: #16a34a;
			--bad: #ef4444;
			--border: #22314d
		}

		body {
			margin: 0;
			padding: 24px;
			background: linear-gradient(180deg, #0b1020, #0d1426);
			color: var(--text);
			font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial
		}

		.container {
			max-width: 980px;
			margin: 0 auto
		}

		.card {
			background: var(--card);
			border: 1px solid var(--border);
			border-radius: 16px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
			overflow: hidden
		}

		header {
			padding: 20px 24px;
			border-bottom: 1px solid var(--border);
			display: flex;
			gap: 12px;
			align-items: center;
			flex-wrap: wrap
		}

		.badge {
			font-size: 12px;
			color: #dbe3ff;
			background: rgba(79, 124, 255, .12);
			padding: 4px 8px;
			border: 1px solid rgba(79, 124, 255, .3);
			border-radius: 999px
		}

		h1 {
			margin: 0;
			font-size: 18px
		}

		.select {
			margin-left: auto
		}

		main {
			padding: 24px
		}

		.prompt {
			line-height: 1.65
		}

		.divider {
			height: 1px;
			background: var(--border);
			margin: 16px 0 20px
		}

		.statement {
			margin: 12px 0;
			padding: 12px;
			border: 1px solid var(--border);
			border-radius: 12px;
			background: rgba(255, 255, 255, .02)
		}

		.row {
			display: flex;
			justify-content: space-between;
			gap: 12px;
			align-items: center;
			flex-wrap: wrap
		}

		.choices {
			display: flex;
			gap: 8px;
			flex-wrap: wrap
		}

		button.choice {
			padding: 8px 12px;
			border-radius: 8px;
			border: 1px solid var(--border);
			background: rgba(255, 255, 255, .02);
			color: var(--text);
			cursor: pointer
		}

		button.choice.active {
			border-color: var(--accent);
			background: rgba(79, 124, 255, .15)
		}

		.result {
			margin-top: 6px;
			font-size: 14px;
			color: var(--muted)
		}

		.result.ok {
			color: var(--ok)
		}

		.result.bad {
			color: var(--bad)
		}

		.bar {
			display: flex;
			gap: 8px;
			margin-top: 16px;
			flex-wrap: wrap
		}

		.action {
			padding: 10px 14px;
			border-radius: 10px;
			border: 1px solid var(--border);
			background: rgba(255, 255, 255, .03);
			color: var(--text);
			cursor: pointer
		}

		.action.primary {
			background: linear-gradient(180deg, #4f7cff, #3b68f7);
			border-color: rgba(79, 124, 255, .6)
		}

		select {
			padding: 8px 10px;
			border-radius: 8px;
			background: #0f162a;
			color: var(--text);
			border: 1px solid var(--border)
		}

		.muted {
			color: var(--muted);
			font-size: 14px;
			margin-top: 8px
		}

		footer {
			padding: 14px 24px;
			border-top: 1px solid var(--border);
			color: var(--muted);
			font-size: 12px
		}

		/* Drag list (sequence) */
		.draglist {
			list-style: none;
			margin: 0;
			padding: 0;
			display: flex;
			flex-direction: column;
			gap: 8px
		}

		.drag-item {
			display: flex;
			align-items: center;
			gap: 10px;
			padding: 10px 12px;
			border: 1px solid var(--border);
			border-radius: 10px;
			background: rgba(255, 255, 255, .03)
		}

		.drag-item[draggable="true"] {
			cursor: grab
		}

		.drag-handle {
			font-size: 14px;
			color: #9db2ff;
			border: 1px dashed rgba(79, 124, 255, .5);
			padding: 2px 6px;
			border-radius: 6px
		}

		.drag-over {
			outline: 2px dashed var(--accent)
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="card">
			<header>
				<span class="badge">Practice Exam</span>
				<h1 id="title">Question</h1>
				<div class="select">
					<label for="qsel" style="font-size:12px;color:var(--muted);margin-right:6px">문항 선택</label>
					<select id="qsel"></select>
				</div>
			</header>
			<main>
				<section id="prompt" class="prompt"></section>
				<div class="divider"></div>
				<section id="dynamic"></section>
				<div class="divider"></div>
				<section id="explanation" class="prompt" style="display:none"></section>
				<div class="bar">
					<button id="prev" class="action">이전</button>
					<button id="next" class="action">다음</button>
					<button id="check" class="action primary">정답 확인</button>
					<button id="reset" class="action">초기화</button>
				</div>
				<p class="muted">이미지가 보이지 않으면 CDN “직접 이미지 링크”인지 확인하세요. 필요 시 ?v=YYYYMMDD 쿼리로 캐시 무효화.</p>
			</main>
			<footer>Files: index.html, questions.js</footer>
		</div>
	</div>

	<script src="./questions.js"></script>
	<script>
		const qs = window.questions || [];
		const $sel = document.getElementById('qsel');
		const $title = document.getElementById('title');
		const $prompt = document.getElementById('prompt');
		const $dynamic = document.getElementById('dynamic');
		const $ex = document.getElementById('explanation');

		let state = { current: 0, yn: [], pair: [], single: [], multi: [], sequence: [] };

		function initSelect() {
			$sel.innerHTML = qs.map((q, i) => `<option value="${i}">${q.id} — ${q.title}</option>`).join('');
			$sel.value = String(state.current);
		}

		function render() {
			const q = qs[state.current]; if (!q) return;
			$title.textContent = `Question ${q.id} — ${q.title}`;
			$prompt.innerHTML = q.promptHtml || "";
			$ex.style.display = "none"; $ex.innerHTML = "";
			$dynamic.innerHTML = "";

			// Yes/No statements
			if (q.statements && q.options) {
				if (!state.yn[state.current]) state.yn[state.current] = new Array(q.statements.length).fill(null);
				const picks = state.yn[state.current];
				$dynamic.innerHTML = q.statements.map((text, idx) => `
          <div class="statement">
            <div class="row">
              <div><strong>Statement ${idx + 1}.</strong> ${text}</div>
              <div class="choices">
                ${q.options.map(opt => {
					const active = picks[idx] === opt ? "active" : "";
					return `<button class="choice ${active}" data-type="yn" data-idx="${idx}" data-opt="${opt}">${opt}</button>`;
				}).join('')}
              </div>
            </div>
            <div class="result" id="res-${idx}"></div>
          </div>
        `).join('');
				return;
			}

			// pair two dropdowns
			if (q.pairLabels && q.pairOptions) {
				if (!state.pair[state.current]) state.pair[state.current] = new Array(q.pairLabels.length).fill("");
				const picks = state.pair[state.current];
				$dynamic.innerHTML = q.pairLabels.map((label, idx) => `
          <div class="statement">
            <div class="row" style="gap:16px;">
              <div><strong>${label}</strong></div>
              <div>
                <select data-type="pair" data-idx="${idx}">
                  <option value="">-- 선택 --</option>
                  ${q.pairOptions.map(opt => `<option value="${opt}" ${picks[idx] === opt ? 'selected' : ''}>${opt}</option>`).join('')}
                </select>
              </div>
            </div>
            <div class="result" id="res-${idx}"></div>
          </div>
        `).join('');
				return;
			}

			// single (one of many)
			if (q.type === "single" && q.options) {
				if (!state.single[state.current]) state.single[state.current] = "";
				const pick = state.single[state.current];
				$dynamic.innerHTML = `
          <div class="statement">
            <div class="choices">
              ${q.options.map(opt => {
					const active = pick === opt ? "active" : "";
					return `<button class="choice ${active}" data-type="single" data-opt="${opt}">${opt}</button>`;
				}).join('')}
            </div>
            <div class="result" id="res-0"></div>
          </div>
        `;
				return;
			}

			// multi (multiple selections)
			if (q.type === "multi" && (q.multiOptions || q.options)) {
				if (!state.multi[state.current]) state.multi[state.current] = new Set();
				const opts = q.multiOptions || q.options;
				const picks = state.multi[state.current];
				$dynamic.innerHTML = `
          <div class="statement">
            <div class="choices">
              ${opts.map(opt => {
					const active = picks.has(opt) ? "active" : "";
					return `<button class="choice ${active}" data-type="multi" data-opt="${opt}">${opt}</button>`;
				}).join('')}
            </div>
            <div class="result" id="res-0"></div>
          </div>
        `;
				return;
			}

			// sequence (drag & drop)
			if (q.type === "sequence" && q.sequenceOptions) {
				if (!state.sequence[state.current]) state.sequence[state.current] = q.sequenceOptions.slice();
				const items = state.sequence[state.current];

				const listHtml = items.map((txt, idx) => `
          <li class="drag-item" draggable="true" data-idx="${idx}">
            <span class="drag-handle">≡</span>
            <span class="drag-text">${txt}</span>
          </li>
        `).join('');

				$dynamic.innerHTML = `
          <div class="statement">
            <ul class="draglist" id="draglist">${listHtml}</ul>
            <div class="muted" style="margin-top:8px">드래그해서 순서를 바꾸세요.</div>
            <div class="result" id="res-0"></div>
          </div>
        `;

				const $list = document.getElementById('draglist');
				let dragEl = null;

				function rebindDnD() {
					$list.querySelectorAll('.drag-item').forEach(el => {
						el.addEventListener('dragstart', (e) => {
							dragEl = el;
							e.dataTransfer.effectAllowed = 'move';
							e.dataTransfer.setData('text/plain', el.dataset.idx);
						});
						el.addEventListener('dragover', (e) => {
							e.preventDefault();
							el.classList.add('drag-over');
							e.dataTransfer.dropEffect = 'move';
						});
						el.addEventListener('dragleave', () => { el.classList.remove('drag-over'); });
						el.addEventListener('drop', (e) => {
							e.preventDefault();
							el.classList.remove('drag-over');
							const fromIdx = Number(dragEl.dataset.idx);
							const toIdx = Number(el.dataset.idx);
							if (fromIdx === toIdx) return;
							const arr = state.sequence[state.current];
							const moved = arr.splice(fromIdx, 1)[0];
							arr.splice(toIdx, 0, moved);
							// 재그리기
							render();
						});
						el.addEventListener('dragend', () => {
							dragEl = null;
							$list.querySelectorAll('.drag-item').forEach(x => x.classList.remove('drag-over'));
						});
					});
				}
				rebindDnD();
				return;
			}

			$dynamic.innerHTML = `<div class="muted">이 문항 타입은 아직 구성되지 않았습니다.</div>`;
		}

		function check() {
			const q = qs[state.current]; if (!q) return;
			let allAnswered = true;

			if (q.statements && q.options) {
				const picks = state.yn[state.current];
				q.statements.forEach((_, idx) => {
					const res = document.getElementById(`res-${idx}`);
					if (picks[idx] == null) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; return; }
					const ok = picks[idx] === q.correctAnswers[idx];
					res.textContent = ok ? "정답!" : `오답. 정답: ${q.correctAnswers[idx]}`;
					res.className = "result " + (ok ? "ok" : "bad");
				});
			} else if (q.pairLabels && q.pairOptions) {
				const picks = state.pair[state.current];
				q.pairLabels.forEach((_, idx) => {
					const res = document.getElementById(`res-${idx}`);
					if (!picks[idx]) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; return; }
					const ok = picks[idx] === q.pairAnswer[idx];
					res.textContent = ok ? "정답!" : `오답. 정답: ${q.pairAnswer[idx]}`;
					res.className = "result " + (ok ? "ok" : "bad");
				});
			} else if (q.type === "single" && q.options) {
				const res = document.getElementById('res-0');
				const pick = state.single[state.current] || "";
				if (!pick) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; }
				else {
					const ok = (q.correctAnswers || []).includes(pick);
					res.textContent = ok ? "정답!" : `오답. 정답: ${(q.correctAnswers || []).join(", ")}`;
					res.className = "result " + (ok ? "ok" : "bad");
				}
			} else if (q.type === "multi") {
				const res = document.getElementById('res-0');
				const picks = Array.from(state.multi[state.current] || []);
				const ans = new Set(q.multiAnswer || q.correctAnswers || []);
				if (picks.length === 0) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; }
				else {
					const ok = picks.length === ans.size && picks.every(x => ans.has(x));
					res.textContent = ok ? "정답!" : `오답. 정답: ${Array.from(ans).join(", ")}`;
					res.className = "result " + (ok ? "ok" : "bad");
				}
			} else if (q.type === "sequence") {
				const res = document.getElementById('res-0');
				const curr = state.sequence[state.current] || [];
				const ans = q.sequenceAnswer || [];
				if (curr.length === 0) { res.textContent = "순서를 정하지 않았어요."; res.className = "result"; allAnswered = false; }
				else {
					const ok = ans.length > 0 && curr.slice(0, ans.length).every((x, i) => x === ans[i]);
					res.textContent = ok ? "정답!" : `오답. 정답 순서: ${ans.join(" → ")}`;
					res.className = "result " + (ok ? "ok" : "bad");
				}
			}

			// 해설 표시 + 링크 새 탭/보안 속성 부여
			if (q.explanationHtml && allAnswered) {
				$ex.innerHTML = q.explanationHtml;
				$ex.style.display = "block";
				$ex.querySelectorAll('a[href]').forEach(a => {
					a.target = '_blank';
					a.rel = 'noopener noreferrer';
				});
			} else if (q.explanationHtml && !allAnswered) {
				$ex.style.display = "none";
				$ex.innerHTML = "";
			}
		}

		function resetCurrent() {
			const q = qs[state.current];
			if (q?.statements) state.yn[state.current] = new Array(q.statements.length).fill(null);
			if (q?.pairLabels) state.pair[state.current] = new Array(q.pairLabels.length).fill("");
			if (q?.type === "single") state.single[state.current] = "";
			if (q?.type === "multi") state.multi[state.current] = new Set();
			if (q?.type === "sequence") state.sequence[state.current] = q.sequenceOptions ? q.sequenceOptions.slice() : [];
			$ex.style.display = "none"; $ex.innerHTML = "";
			render();
		}

		function goto(offset) {
			const n = qs.length; if (n === 0) return;
			state.current = (state.current + offset + n) % n;
			$sel.value = String(state.current);
			render();
		}

		document.addEventListener('click', (e) => {
			const t = e.target;

			if (t.matches('button.choice')) {
				const type = t.getAttribute('data-type');
				if (type === 'yn') {
					const idx = Number(t.getAttribute('data-idx'));
					const opt = t.getAttribute('data-opt');
					const picks = state.yn[state.current];
					picks[idx] = opt;
					document.querySelectorAll(`button.choice[data-idx="${idx}"]`).forEach(btn => {
						btn.classList.toggle('active', btn.getAttribute('data-opt') === opt);
					});
				}
				if (type === 'single') {
					const opt = t.getAttribute('data-opt');
					state.single[state.current] = opt;
					document.querySelectorAll('button.choice[data-type="single"]').forEach(btn => {
						btn.classList.toggle('active', btn.getAttribute('data-opt') === opt);
					});
				}
				if (type === 'multi') {
					const opt = t.getAttribute('data-opt');
					const set = state.multi[state.current] || new Set();
					if (set.has(opt)) set.delete(opt); else set.add(opt);
					state.multi[state.current] = set;
					t.classList.toggle('active');
				}
			}

			if (t.id === 'check') check();
			if (t.id === 'reset') resetCurrent();
			if (t.id === 'prev') goto(-1);
			if (t.id === 'next') goto(+1);
		});

		document.addEventListener('change', (e) => {
			const t = e.target;
			if (t.id === 'qsel') { state.current = Number(t.value); render(); }
			if (t.matches('select[data-type="pair"]')) {
				const idx = Number(t.getAttribute('data-idx'));
				const picks = state.pair[state.current] || [];
				picks[idx] = t.value; state.pair[state.current] = picks;
			}
		});

		document.addEventListener('keydown', (e) => {
			if (e.key === 'ArrowLeft') goto(-1);
			if (e.key === 'ArrowRight') goto(+1);
		});

		initSelect(); render();
	</script>
</body>

</html>