<!doctype html>
<html lang="ko">

<head>
	<meta charset="utf-8">
	<title>Practice Exam – MS-102</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		:root {
			--bg: #0b1020;
			--card: #11182a;
			--text: #e6e9f2;
			--muted: #aab2c5;
			--accent: #4f7cff;
			--ok: #16a34a;
			--bad: #ef4444;
			--border: #22314d;
		}

		body {
			margin: 0;
			padding: 24px;
			background: linear-gradient(180deg, #0b1020, #0d1426);
			color: var(--text);
			font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial
		}

		.container {
			max-width: 980px;
			margin: 0 auto
		}

		.card {
			background: var(--card);
			border: 1px solid var(--border);
			border-radius: 16px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
			overflow: hidden
		}

		header {
			padding: 20px 24px;
			border-bottom: 1px solid var(--border);
			display: flex;
			gap: 12px;
			align-items: center;
			flex-wrap: wrap
		}

		.badge {
			font-size: 12px;
			color: #dbe3ff;
			background: rgba(79, 124, 255, .12);
			padding: 4px 8px;
			border: 1px solid rgba(79, 124, 255, .3);
			border-radius: 999px
		}

		h1 {
			margin: 0;
			font-size: 18px
		}

		main {
			padding: 24px
		}

		.prompt {
			line-height: 1.65
		}

		.divider {
			height: 1px;
			background: var(--border);
			margin: 16px 0 20px
		}

		.statement {
			margin: 12px 0;
			padding: 12px;
			border: 1px solid var(--border);
			border-radius: 12px;
			background: rgba(255, 255, 255, .02)
		}

		.row {
			display: flex;
			justify-content: space-between;
			gap: 12px;
			align-items: center;
			flex-wrap: wrap
		}

		.choices {
			display: flex;
			gap: 8px;
			flex-wrap: wrap
		}

		button.choice {
			padding: 8px 12px;
			border-radius: 8px;
			border: 1px solid var(--border);
			background: rgba(255, 255, 255, .02);
			color: var(--text);
			cursor: pointer
		}

		button.choice.active {
			border-color: var(--accent);
			background: rgba(79, 124, 255, .15)
		}

		.result {
			margin-top: 6px;
			font-size: 14px;
			color: var(--muted)
		}

		.result.ok {
			color: var(--ok)
		}

		.result.bad {
			color: var(--bad)
		}

		.bar {
			display: flex;
			gap: 8px;
			margin-top: 16px;
			flex-wrap: wrap
		}

		.action {
			padding: 10px 14px;
			border-radius: 10px;
			border: 1px solid var(--border);
			background: rgba(255, 255, 255, .03);
			color: var(--text);
			cursor: pointer
		}

		.action.primary {
			background: linear-gradient(180deg, #4f7cff, #3b68f7);
			border-color: rgba(79, 124, 255, .6)
		}

		select,
		input[type="number"] {
			padding: 8px 10px;
			border-radius: 8px;
			background: #0f162a;
			color: var(--text);
			border: 1px solid var(--border)
		}

		.muted {
			color: var(--muted);
			font-size: 14px;
			margin-top: 8px
		}

		footer {
			padding: 14px 24px;
			border-top: 1px solid var(--border);
			color: var(--muted);
			font-size: 12px
		}

		.home {
			display: flex;
			flex-direction: column;
			gap: 16px
		}

		.slider-row {
			display: flex;
			gap: 12px;
			align-items: center;
			flex-wrap: wrap
		}

		input[type="range"] {
			width: 280px
		}

		.pill {
			padding: 4px 10px;
			border: 1px solid var(--border);
			border-radius: 999px;
			font-size: 12px;
			color: #dbe3ff;
			background: rgba(255, 255, 255, .05)
		}

		/* Drag list */
		.draglist {
			list-style: none;
			margin: 0;
			padding: 0;
			display: flex;
			flex-direction: column;
			gap: 8px
		}

		.drag-item {
			display: flex;
			align-items: center;
			gap: 10px;
			padding: 10px 12px;
			border: 1px solid var(--border);
			border-radius: 10px;
			background: rgba(255, 255, 255, .03)
		}

		.drag-item[draggable="true"] {
			cursor: grab
		}

		.drag-handle {
			font-size: 14px;
			color: #9db2ff;
			border: 1px dashed rgba(79, 124, 255, .5);
			padding: 2px 6px;
			border-radius: 6px
		}

		.drag-over {
			outline: 2px dashed var(--accent)
		}

		.center {
			display: flex;
			align-items: center;
			justify-content: center
		}

		.scorebox {
			text-align: center;
			padding: 24px;
			border: 1px solid var(--border);
			border-radius: 12px;
			background: rgba(255, 255, 255, .02)
		}
	</style>
</head>

<body>
	<div class="container">
		<div class="card">
			<header>
				<span class="badge">Practice Exam</span>
				<h1 id="title">MS-102 Quiz</h1>
				<span id="runMeta" class="pill" style="display:none"></span>
			</header>

			<main>
				<!-- Home screen -->
				<section id="home" class="home">
					<div>
						<h2 style="margin:0 0 6px 0; font-size:16px">퀴즈 시작</h2>
						<p class="muted" style="margin:0">문제 수를 선택하거나 특정 문항 ID로 바로 시작할 수 있습니다.</p>
					</div>

					<!-- 문제 수 선택 -->
					<div class="slider-row">
						<label for="qcount" style="font-size:14px;color:var(--muted)">문제 수</label>
						<!-- max 값을 100으로 확장 -->
						<input id="qcount" type="range" min="5" max="100" step="1" value="10">
						<span id="qcountLabel" class="pill">10</span>
					</div>

					<!-- 무작위 추출 -->
					<div class="slider-row">
						<label for="shuffle" style="font-size:14px;color:var(--muted)">무작위 추출</label>
						<input id="shuffle" type="checkbox" checked>
						<span class="muted">체크 시 문제를 섞어서 출제</span>
					</div>

					<!-- 문항 ID 바로 시작 기능 (신규) -->
					<div class="slider-row">
						<label for="byId" style="font-size:14px;color:var(--muted)">문항 ID 바로 시작</label>
						<input id="byId" type="checkbox">
						<input id="qid" type="number" placeholder="문항 ID" style="width:140px" min="1" disabled>
						<span class="muted">체크하면 슬라이더/섞기 설정을 무시하고 해당 ID로 바로 시작</span>
					</div>

					<div class="bar">
						<button id="start" class="action primary">Start</button>
					</div>
					<div class="muted">참고: 상단의 Files: questions.js 에서 문제 라이브러리를 로드합니다.</div>
				</section>

				<!-- Quiz screen -->
				<section id="quiz" style="display:none">
					<div class="row" style="gap:10px; margin-bottom:12px">
						<span id="progress" class="pill">1 / 10</span>
						<span id="scoreLive" class="pill">Score 0</span>
					</div>
					<section id="prompt" class="prompt"></section>
					<div class="divider"></div>
					<section id="dynamic"></section>
					<div class="divider"></div>
					<section id="explanation" class="prompt" style="display:none"></section>

					<div class="bar">
						<button id="prev" class="action">이전</button>
						<button id="next" class="action">다음</button>
						<button id="check" class="action primary">정답 확인</button>
						<button id="reset" class="action">현재 문제 초기화</button>
						<button id="quit" class="action" style="margin-left:auto">종료</button>
					</div>
					<p class="muted">이 테스트 프로그램은 개인적인 목적으로 사용하도록 작성되었습니다.</p>
				</section>

				<!-- Result screen -->
				<section id="result" style="display:none">
					<div class="scorebox">
						<h2 style="margin-top:0">결과</h2>
						<p id="scoreLine" style="font-size:20px; margin:6px 0 12px 0">0 / 0 (0%)</p>
						<p id="timeLine" class="muted" style="margin-top:0">소요 시간: -</p>
						<div class="bar center" style="justify-content:center">
							<button id="again" class="action">처음으로</button>
							<button id="review" class="action primary">오답만 다시 보기</button>
						</div>
					</div>
				</section>
			</main>

			<footer>Files: index.html, questions.js</footer>
		</div>
	</div>

	<script src="./questions.js"></script>
	<script>
		// ========== 상태 ==========
		const ALL = (() => (window.questions || []).slice())();
		const $home = document.getElementById('home');
		const $quiz = document.getElementById('quiz');
		const $result = document.getElementById('result');
		const $qcount = document.getElementById('qcount');
		const $qcountLabel = document.getElementById('qcountLabel');
		const $shuffle = document.getElementById('shuffle');
		const $runMeta = document.getElementById('runMeta');

		const $prompt = document.getElementById('prompt');
		const $dynamic = document.getElementById('dynamic');
		const $ex = document.getElementById('explanation');
		const $progress = document.getElementById('progress');
		const $scoreLive = document.getElementById('scoreLive');
		const $title = document.getElementById('title');

		// 신규: 문항 ID 바로 시작
		const $byId = document.getElementById('byId');
		const $qid = document.getElementById('qid');

		// 선택된 세트
		let RUN = {
			set: [],            // 선택된 문제 배열
			mapIdx: [],         // 원본 인덱스 매핑
			current: 0,
			startAt: 0,
			endAt: 0,
			// per-question states (by run index)
			yn: {}, pair: {}, single: {}, multi: {}, sequence: {},
			// scoring
			checkedCorrect: {}, // {runIndex: true} 채점 성공 기록
			// for review wrong only
			wrongOrder: []
		};

		// 기존 렌더를 약간 개조해서 "RUN.set"만을 대상으로 동작
		function chooseSet() {
			// 문항 ID 바로 시작 모드
			if ($byId.checked) {
				const id = parseInt($qid.value, 10);
				if (!id) { alert('문항 ID를 입력해 주세요.'); return; }
				const idx = ALL.findIndex(q => q.id === id);
				if (idx === -1) { alert(`ID ${id} 문항을 찾을 수 없습니다.`); return; }
				RUN.set = [ALL[idx]];
				RUN.mapIdx = [idx];
				RUN.current = 0;
				RUN.startAt = Date.now();
				RUN.endAt = 0;
				RUN.yn = {}; RUN.pair = {}; RUN.single = {}; RUN.multi = {}; RUN.sequence = {};
				RUN.checkedCorrect = {};
				RUN.wrongOrder = [];
				updateMeta();
				return;
			}

			// 기본 무작위/슬라이더 모드
			const n = Math.min(parseInt($qcount.value, 10), ALL.length);
			let idxs = [...Array(ALL.length).keys()];
			if ($shuffle.checked) idxs.sort(() => Math.random() - 0.5);
			const pickIdxs = idxs.slice(0, n);
			RUN.set = pickIdxs.map(i => ALL[i]);
			RUN.mapIdx = pickIdxs;
			RUN.current = 0;
			RUN.startAt = Date.now();
			RUN.endAt = 0;
			RUN.yn = {}; RUN.pair = {}; RUN.single = {}; RUN.multi = {}; RUN.sequence = {};
			RUN.checkedCorrect = {};
			RUN.wrongOrder = [];
			updateMeta();
		}
		function updateMeta() {
			$runMeta.style.display = 'inline-block';
			$runMeta.textContent = `Selected ${RUN.set.length} / Total ${ALL.length}`;
			$progress.textContent = `${RUN.current + 1} / ${RUN.set.length}`;
			$scoreLive.textContent = `Score ${Object.keys(RUN.checkedCorrect).length}`;
		}
		function percentScore() {
			const got = Object.keys(RUN.checkedCorrect).length;
			const total = RUN.set.length;
			return { got, total, pct: total ? Math.round(got * 100 / total) : 0 };
		}

		// ===== 기존 렌더·채점 로직 =====
		function render() {
			const q = RUN.set[RUN.current]; if (!q) return;
			$title.textContent = `Question ${q.id} — ${q.title}`;
			$prompt.innerHTML = q.promptHtml || "";
			$ex.style.display = "none"; $ex.innerHTML = "";
			$dynamic.innerHTML = "";
			// statements (Yes/No)
			if (q.statements && q.options) {
				if (!RUN.yn[RUN.current]) RUN.yn[RUN.current] = new Array(q.statements.length).fill(null);
				const picks = RUN.yn[RUN.current];
				$dynamic.innerHTML = q.statements.map((text, idx) => `
          <div class="statement">
            <div class="row">
              <div><strong>Statement ${idx + 1}.</strong> ${text}</div>
              <div class="choices">
                ${q.options.map(opt => {
					const active = picks[idx] === opt ? "active" : "";
					return `<button class="choice ${active}" data-type="yn" data-idx="${idx}" data-opt="${opt}">${opt}</button>`;
				}).join('')}
              </div>
            </div>
            <div class="result" id="res-${idx}"></div>
          </div>
        `).join('');
				return;
			}
			// pair
			if (q.pairLabels && (q.pairOptions || (q.pairOptionsLeft && q.pairOptionsRight))) {
				if (!RUN.pair[RUN.current]) RUN.pair[RUN.current] = new Array(q.pairLabels.length).fill("");
				const picks = RUN.pair[RUN.current];
				const leftOpts = q.pairOptionsLeft || q.pairOptions || [];
				const rightOpts = q.pairOptionsRight || q.pairOptions || [];
				$dynamic.innerHTML = q.pairLabels.map((label, idx) => {
					const opts = (idx === 0) ? leftOpts : (idx === 1 ? rightOpts : (q.pairOptions || []));
					const options = [`<option value="">-- 선택 --</option>`]
						.concat(opts.map(opt => `<option value="${escapeHtml(opt)}" ${picks[idx] === opt ? 'selected' : ''}>${escapeHtml(opt)}</option>`)).join('');
					return `
            <div class="statement">
              <div class="row" style="gap:16px;">
                <div><strong>${label}</strong></div>
                <div><select data-type="pair" data-idx="${idx}">${options}</select></div>
              </div>
              <div class="result" id="res-${idx}"></div>
            </div>
          `;
				}).join('');
				$dynamic.querySelectorAll('select[data-type="pair"]').forEach(sel => {
					sel.addEventListener('change', e => {
						const i = Number(e.target.getAttribute('data-idx'));
						RUN.pair[RUN.current][i] = unescapeHtml(e.target.value);
					});
				});
				return;
			}
			// single
			if (q.type === "single" && q.options) {
				if (!RUN.single[RUN.current]) RUN.single[RUN.current] = "";
				const pick = RUN.single[RUN.current];
				$dynamic.innerHTML = `
          <div class="statement">
            <div class="choices">
              ${q.options.map(opt => {
					const active = pick === opt ? "active" : "";
					return `<button class="choice ${active}" data-type="single" data-opt="${opt}">${opt}</button>`;
				}).join('')}
            </div>
            <div class="result" id="res-0"></div>
          </div>
        `;
				return;
			}
			// multi
			if (q.type === "multi" && (q.multiOptions || q.options)) {
				if (!RUN.multi[RUN.current]) RUN.multi[RUN.current] = new Set();
				const opts = q.multiOptions || q.options;
				const picks = RUN.multi[RUN.current];
				$dynamic.innerHTML = `
          <div class="statement">
            <div class="choices">
              ${opts.map(opt => {
					const active = picks.has(opt) ? "active" : "";
					return `<button class="choice ${active}" data-type="multi" data-opt="${opt}">${opt}</button>`;
				}).join('')}
            </div>
            <div class="result" id="res-0"></div>
          </div>
        `;
				return;
			}
			// sequence
			if (q.type === "sequence" && q.sequenceOptions) {
				if (!RUN.sequence[RUN.current]) RUN.sequence[RUN.current] = q.sequenceOptions.slice();
				const items = RUN.sequence[RUN.current];
				const listHtml = items.map((txt, idx) => `
          <li class="drag-item" draggable="true" data-idx="${idx}">
            <span class="drag-handle">≡</span>
            <span class="drag-text">${txt}</span>
          </li>
        `).join('');
				$dynamic.innerHTML = `
          <div class="statement">
            <ul class="draglist" id="draglist">${listHtml}</ul>
            <div class="muted" style="margin-top:8px">드래그해서 순서를 바꾸세요.</div>
            <div class="result" id="res-0"></div>
          </div>
        `;
				const $list = document.getElementById('draglist');
				let dragEl = null;
				$list.querySelectorAll('.drag-item').forEach(el => {
					el.addEventListener('dragstart', e => {
						dragEl = el; e.dataTransfer.effectAllowed = 'move'; e.dataTransfer.setData('text/plain', el.dataset.idx);
					});
					el.addEventListener('dragover', e => { e.preventDefault(); el.classList.add('drag-over'); e.dataTransfer.dropEffect = 'move'; });
					el.addEventListener('dragleave', () => el.classList.remove('drag-over'));
					el.addEventListener('drop', e => {
						e.preventDefault(); el.classList.remove('drag-over');
						const fromIdx = Number(dragEl.dataset.idx); const toIdx = Number(el.dataset.idx);
						if (fromIdx === toIdx) return;
						const arr = RUN.sequence[RUN.current];
						const moved = arr.splice(fromIdx, 1)[0]; arr.splice(toIdx, 0, moved); render();
					});
					el.addEventListener('dragend', () => {
						const n = document.getElementById('draglist'); if (!n) return;
						n.querySelectorAll('.drag-item').forEach(x => x.classList.remove('drag-over'));
						dragEl = null;
					});
				});
				return;
			}
			$dynamic.innerHTML = `<div class="muted">이 문항 타입은 아직 구성되지 않았습니다.</div>`;
		}

		function check() {
			const q = RUN.set[RUN.current]; if (!q) return;
			let allAnswered = true, allCorrect = true;

			if (q.statements && q.options) {
				const picks = RUN.yn[RUN.current];
				q.statements.forEach((_, idx) => {
					const res = document.getElementById(`res-${idx}`);
					if (picks[idx] == null) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; return; }
					const ok = picks[idx] === q.correctAnswers[idx];
					res.textContent = ok ? "정답!" : `오답. 정답: ${q.correctAnswers[idx]}`;
					res.className = "result " + (ok ? "ok" : "bad");
					if (!ok) allCorrect = false;
				});
			} else if (q.pairLabels && (q.pairOptions || (q.pairOptionsLeft && q.pairOptionsRight))) {
				const picks = RUN.pair[RUN.current] || [];
				q.pairLabels.forEach((_, idx) => {
					const res = document.getElementById(`res-${idx}`);
					if (!picks[idx]) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; return; }
					const ok = picks[idx] === (q.pairAnswer || [])[idx];
					res.textContent = ok ? "정답!" : `오답. 정답: ${q.pairAnswer[idx]}`;
					res.className = "result " + (ok ? "ok" : "bad");
					if (!ok) allCorrect = false;
				});
			} else if (q.type === "single" && q.options) {
				const res = document.getElementById('res-0');
				const pick = RUN.single[RUN.current] || "";
				if (!pick) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; }
				else {
					const ok = (q.correctAnswers || []).includes(pick);
					res.textContent = ok ? "정답!" : `오답. 정답: ${(q.correctAnswers || []).join(", ")}`;
					res.className = "result " + (ok ? "ok" : "bad");
					if (!ok) allCorrect = false;
				}
			} else if (q.type === "multi") {
				const res = document.getElementById('res-0');
				const picks = Array.from(RUN.multi[RUN.current] || []);
				const ans = new Set(q.multiAnswer || q.correctAnswers || []);
				if (picks.length === 0) { res.textContent = "선택하지 않았어요."; res.className = "result"; allAnswered = false; }
				else {
					const ok = picks.length === ans.size && picks.every(x => ans.has(x));
					res.textContent = ok ? "정답!" : `오답. 정답: ${Array.from(ans).join(", ")}`;
					res.className = "result " + (ok ? "ok" : "bad");
					if (!ok) allCorrect = false;
				}
			} else if (q.type === "sequence") {
				const res = document.getElementById('res-0');
				const curr = RUN.sequence[RUN.current] || [];
				const ans = q.sequenceAnswer || [];
				if (curr.length === 0) { res.textContent = "순서를 정하지 않았어요."; res.className = "result"; allAnswered = false; }
				else {
					const ok = ans.length > 0 && curr.slice(0, ans.length).every((x, i) => x === ans[i]);
					res.textContent = ok ? "정답!" : `오답. 정답 순서: ${ans.join(" → ")}`;
					res.className = "result " + (ok ? "ok" : "bad");
					if (!ok) allCorrect = false;
				}
			}

			if (q.explanationHtml && allAnswered) {
				$ex.innerHTML = q.explanationHtml;
				$ex.style.display = "block";
				$ex.querySelectorAll('a[href]').forEach(a => { a.target = '_blank'; a.rel = 'noopener noreferrer'; });
			} else if (q.explanationHtml && !allAnswered) {
				$ex.style.display = "none"; $ex.innerHTML = "";
			}

			if (allAnswered) {
				if (allCorrect) {
					RUN.checkedCorrect[RUN.current] = true;
					// 정답에서 제외
					RUN.wrongOrder = RUN.wrongOrder.filter(x => x !== RUN.current);
				} else {
					delete RUN.checkedCorrect[RUN.current];
					if (!RUN.wrongOrder.includes(RUN.current)) RUN.wrongOrder.push(RUN.current);
				}
				updateMeta();
			}
		}

		function resetCurrent() {
			const q = RUN.set[RUN.current];
			if (q?.statements) RUN.yn[RUN.current] = new Array(q.statements.length).fill(null);
			if (q?.pairLabels) RUN.pair[RUN.current] = new Array(q.pairLabels.length).fill("");
			if (q?.type === "single") RUN.single[RUN.current] = "";
			if (q?.type === "multi") RUN.multi[RUN.current] = new Set();
			if (q?.type === "sequence") RUN.sequence[RUN.current] = q.sequenceOptions ? q.sequenceOptions.slice() : [];
			$ex.style.display = "none"; $ex.innerHTML = ""; render();
		}

		function goto(offset) {
			const n = RUN.set.length; if (n === 0) return;
			RUN.current = (RUN.current + offset + n) % n;
			$progress.textContent = `${RUN.current + 1} / ${RUN.set.length}`;
			render();
		}

		function showResult() {
			RUN.endAt = Date.now();
			const { got, total, pct } = percentScore();
			document.getElementById('scoreLine').textContent = `${got} / ${total} (${pct}%)`;
			const ms = RUN.endAt - RUN.startAt;
			const mm = Math.floor(ms / 60000), ss = Math.floor((ms % 60000) / 1000);
			document.getElementById('timeLine').textContent = `소요 시간: ${mm}분 ${ss}초`;
			$quiz.style.display = 'none'; $result.style.display = 'block'; $home.style.display = 'none';
		}

		function escapeHtml(s = '') { return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'); }
		function unescapeHtml(s = '') { const d = document.createElement('textarea'); d.innerHTML = String(s); return d.value; }

		// ===== 이벤트 바인딩 =====
		document.getElementById('qcount').addEventListener('input', e => {
			$qcountLabel.textContent = e.target.value;
		});

		// 신규: 문항 ID 체크박스 on/off에 따라 입력 활성화
		$byId.addEventListener('change', () => {
			const on = $byId.checked;
			$qid.disabled = !on;
		});

		document.getElementById('start').addEventListener('click', () => {
			chooseSet();
			$home.style.display = 'none'; $quiz.style.display = 'block'; $result.style.display = 'none';
			render(); updateMeta();
		});
		document.getElementById('again').addEventListener('click', () => {
			$home.style.display = 'block'; $quiz.style.display = 'none'; $result.style.display = 'none';
			$runMeta.style.display = 'none';
			// 홈으로 돌아올 때 ID모드 초기화 UX(선택적)
			// $byId.checked = false; $qid.disabled = true; $qid.value = "";
		});
		document.getElementById('review').addEventListener('click', () => {
			// 오답만 다시 보기
			if (RUN.wrongOrder.length === 0) {
				alert('오답이 없습니다. 처음으로 돌아갑니다.');
				document.getElementById('again').click(); return;
			}
			const newSet = RUN.wrongOrder.map(i => RUN.set[i]);
			RUN.set = newSet; RUN.mapIdx = RUN.wrongOrder.slice();
			RUN.current = 0; RUN.startAt = Date.now(); RUN.endAt = 0;
			RUN.yn = {}; RUN.pair = {}; RUN.single = {}; RUN.multi = {}; RUN.sequence = {};
			RUN.checkedCorrect = {}; RUN.wrongOrder = [];
			$result.style.display = 'none'; $quiz.style.display = 'block';
			updateMeta(); render();
		});

		document.addEventListener('click', (e) => {
			const t = e.target;
			if (t.matches('button.choice')) {
				const type = t.getAttribute('data-type');
				if (type === 'yn') {
					const idx = Number(t.getAttribute('data-idx'));
					const opt = t.getAttribute('data-opt');
					const picks = RUN.yn[RUN.current];
					picks[idx] = opt;
					document.querySelectorAll(`button.choice[data-idx="${idx}"]`).forEach(btn => {
						btn.classList.toggle('active', btn.getAttribute('data-opt') === opt);
					});
				}
				if (type === 'single') {
					const opt = t.getAttribute('data-opt');
					RUN.single[RUN.current] = opt;
					document.querySelectorAll('button.choice[data-type="single"]').forEach(btn => {
						btn.classList.toggle('active', btn.getAttribute('data-opt') === opt);
					});
				}
				if (type === 'multi') {
					const opt = t.getAttribute('data-opt');
					const set = RUN.multi[RUN.current] || new Set();
					if (set.has(opt)) set.delete(opt); else set.add(opt);
					RUN.multi[RUN.current] = set;
					t.classList.toggle('active');
				}
			}
			if (t.id === 'check') { check(); }
			if (t.id === 'reset') { resetCurrent(); }
			if (t.id === 'prev') { goto(-1); }
			if (t.id === 'next') {
				// 마지막 문제에서 next를 누르면 결과
				if (RUN.current === RUN.set.length - 1) showResult();
				else goto(+1);
			}
			if (t.id === 'quit') {
				if (confirm('종료하고 처음 화면으로 돌아갈까요? 진행 상황은 사라집니다.')) {
					document.getElementById('again').click();
				}
			}
		});

		document.addEventListener('keydown', (e) => {
			if ($quiz.style.display !== 'block') return;
			if (e.key === 'ArrowLeft') goto(-1);
			if (e.key === 'ArrowRight') {
				if (RUN.current === RUN.set.length - 1) showResult(); else goto(+1);
			}
		});
	</script>
</body>

</html>